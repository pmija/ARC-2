{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ARC | Time In-Out</title>

    <link href="{% static 'production/custom-font/montserrat.css' %}" rel="stylesheet">
    <!-- Bootstrap -->
    <link href="{% static 'production/../vendors/bootstrap/dist/css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="{% static 'production/../vendors/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">
    <!-- NProgress -->
    <link href="{% static 'production/../vendors/nprogress/nprogress.css' %}" rel="stylesheet">
    <!-- Animate.css -->
    <link href="{% static 'production/../vendors/animate.css/animate.min.css' %}" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="{% static 'production/../build/css/custom.css' %}" rel="stylesheet">
	<style>
	h5   {margin-bottom:5px;font-weight:bold;font-size:16px;}
	h6   {margin-bottom:25px;font-size:15px;}
	</style>
  </head>

  <body class="login">
    <div class="nav">

      <div class="login_wrapper">
          <section class="login_content">

            <div class="row">

              <div class="col-md-1">
              </div>

              <div class="col-md-9">
                <img src="{% static 'production/images/logo.png' %}" id="login_logo" style="width:100px;length:100px;">
              </div>

            </div>

            <form>{% csrf_token %}
			  <div class="form-group">
				<label class="control-label col-md-3 col-sm-3 col-xs-12" for="uniqueid">Unique ID Number</label>
                   <div class="col-md-8 col-sm-6 col-xs-12">
                      <input type="text" id="uniqueid" class="form-control col-md-7 col-xs-12">
                   </div>
              </div>
              <div class="clearfix"></div>
			  <div class="separator"></div>
            </form>
          </section>

    </div>

    <div id="userinfo" style="width:100%; visibility: hidden;" >
    </div>
	{% include 'import-js.html' %}
	<script>
	let nfc;
	let time = 1000;
	let prev;
	window.onload = () =>{
		setInterval(() =>{
			$.ajax({
				url: 'ajax/nfcajax',
				type: 'GET',
				success: (response) =>{
      				var data = JSON.parse(response);
      				if(data['ready']==true){
						if(prev !== data['tag']){
							var elem = document.getElementById('uniqueid');
							elem.value = data['tag'];
							nfc = data['tag'];
							prev = data['tag'];
							timeinout.getUserInformation(elem);
							setTimeout(() => {
								prev = '';
							}, 5000)
						}
      				}
            	}
			});
		}, time);
	}
	
	let timeinout = {
		getUserInformation: (elem) =>{
			let id = elem.value;
			console.log(id)
			$.ajax({
				url: "/ajax/getUserTimeInInfo",
				method: "POST",
				data:{
					'id':id,
					'csrfmiddlewaretoken':$( 'input[name=csrfmiddlewaretoken]' ).val()
				},
				success: (data) =>{
					let parsedData = JSON.parse(data);
					if(parsedData.length === 0){
						console.log('Lab is currently not available')
					}
					else{
						console.log(parsedData)
					}
				}
			});
		}
	
	}

	</script>
  </body>
</html>
